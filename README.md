---

# Dicom_Save - ImageJ/Fiji プラグイン

## 1. 概要
このプラグインは，ImageJ/Fijiで現在開いている画像 (スタック画像を含む) を，マルチフレーム DICOM 形式 (.dcm) で保存するためのものです．

## 2. 主な機能
-   現在アクティブな画像を DICOM 形式で保存します．
-   スタック画像 (Z スタック，タイムシリーズなど) を 1 つのマルチフレーム DICOM ファイルとして保存します．
-   以下のビット深度のグレースケール画像に対応しています:
    -   8-bit
    -   16-bit (signed/unsigned)
    -   32-bit (float)
-   保存時に，画像表示に必要な基本的な DICOM ヘッダー情報を自動的に生成・付与します．

## 3. インストール方法
この配布物には，プラグイン本体 (Dicom_Save.class) とソースコード (Dicom_Save.java) が含まれています．

1.  Dicom_Save.class ファイルを，お使いの ImageJ または Fiji の plugins フォルダにコピーしてください．
    -   **Fiji の場合:** `Fiji.app/plugins/`
    -   **ImageJ の場合:** `ImageJ/plugins/`
2.  ImageJ/Fiji を起動 (または再起動) します．
3.  メニューバーの Plugins の中に Dicom_Save という項目が追加されていれば，インストールは成功です．

## 4. 使い方
1.  DICOM 形式で保存したい画像を ImageJ/Fiji で開きます．
2.  メニューから Plugins > Dicom_Save を選択します．
3.  「Save as Multi-Frame DICOM」というタイトルの保存ダイアログが表示されます．
4.  保存先のディレクトリとファイル名（拡張子は .dcm）を指定し，「Save」ボタンをクリックします．
5.  保存が正常に完了すると，「DICOM file written to: ...」というメッセージダイアログが表示されます．

## 5. 注意事項
-   **限定的な DICOM タグ:** このプラグインは，画像表示に必要な最小限の DICOM タグのみを生成します．患者情報 (Patient Name など) は `"Patient^Name"` のような固定値が書き込まれます．
-   **カラー画像非対応:** このプラグインはグレースケール画像 (Photometric Interpretation: MONOCHROME2) 専用です．カラー画像を保存しようとすると，意図しない結果になる可能性があります．
-   **医療診断目的での使用禁止:** このプラグインによって生成された DICOM ファイルは，あくまで研究やデータ交換を目的としたものです．**医療診断には絶対に使用しないでください．**
-   **UID の生成:** SOP Instance UID などのユニーク ID は，現在時刻を元に簡易的に生成されます．厳密な一意性を保証するものではありません．

## 6. 開発者向け情報 (コンパイル方法)
ImageJ または Fiji に搭載されている内蔵コンパイラでは，環境によってコンパイルに失敗することがあります．その場合は，ターミナル (またはコマンドプロンプト) から手動でコンパイルして下さい．

### 必要なもの
-   Java Development Kit (JDK)
-   ImageJ/Fiji 本体（ij-*.jar をクラスパスに指定するため）

### コンパイルコマンド
1.  ターミナルを開き，`Dicom_Save.java` があるディレクトリに移動します．
2.  以下のコマンドを実行してコンパイルします．-cp (-classpath) の後のパスは，ご自身の環境にある ImageJ/Fiji の JAR ファイルのパスに修正してください．

コンパイルが成功すると，同ディレクトリに Dicom_Save.class ファイルが生成されます．
